<html>
    <head>
        <script
            type="text/javascript"
            src="../js/jquery-1.4.2.min.js">
        </script>
        <script
            type="text/javascript"
            src="../syntax_highlighter/scripts/shCore.js">
        </script>
        <script
            type="text/javascript"
            src="../syntax_highlighter/scripts/shBrushJScript.js">
        </script>
        <script
            type="text/javascript"
            src="../syntax_highlighter/scripts/shBrushPhp.js">
        </script>
        <script
            type="text/javascript"
            src="../syntax_highlighter/scripts/shBrushXml.js">
        </script>
        <link
            href="../syntax_highlighter/styles/shCore.css" rel="stylesheet"
            type="text/css"
        />
        <link
            href="../syntax_highlighter/styles/shCoreEclipse.css"
            rel="stylesheet" type="text/css"
        />
        <link
            href="../syntax_highlighter/styles/shThemeWordpress.css"
            rel="stylesheet" type="text/css"
        />
    </head>
    <body>
        <pre class="brush: php">&lt;?php

namespace mine_apple\Http\Controllers;

use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use mine_apple\Assinatura;
use mine_apple\Assinatura_Produto;
use mine_apple\Avaliacao;
use mine_apple\Categoria;
use mine_apple\Embalagem;
use mine_apple\Financa;
use mine_apple\Foto;
use mine_apple\Produto;
use mine_apple\Estado;
use mine_apple\Cidade;
use mine_apple\Conta;
use mine_apple\Banco;
use mine_apple\Log;
use mine_apple\Produtor;
use mine_apple\Endereco;
use mine_apple\Http\Requests\FormProdutor;

class ProdutorController extends Controller
{

    /**
    * Retorna index
    * @author Rafael
    * @return \Illuminate\Contracts\View\Factory|\Illuminate\View\View
    */
    public function index(){
        return view('index');
    }

    /**
     * Retorna o formul&aacute;rio de cadastro
     * @author Lucas Alves
     * @return \Illuminate\Contracts\View\Factory|\Illuminate\View\View
     */
    public function getForm(){
            $bancos = Banco::all(['id', 'nome']);
            $estados = Estado::all(['id', 'nome']);
            return view('cadastro_de_produtor',compact('estados','bancos'));
    }

    /**
     * Cadastra um Produtor
     * @author Lucas Alves
     * @param Request $request
     * @return \Illuminate\Contracts\View\Factory|\Illuminate\View\View
     */
    public function cadastrarProdutor(FormProdutor $request) {



        //dd($request-&gt;all());
        //Informa&ccedil;&otilde;es Produtor
        $produtor = new Produtor;
        $produtor-&gt;usuario_id = Auth::user()-&gt;id;
        $produtor-&gt;cnpj = $request-&gt;cnpj;
        $produtor-&gt;nomeFantasia = $request-&gt;nomeFantasia;
        $produtor-&gt;razaoSocial = $request-&gt;razaoSocial;
        $produtor-&gt;telefone = $request-&gt;telefone;
        $produtor-&gt;raioEntrega = $request-&gt;raioEntrega;
        $produtor-&gt;avaliacao = 0;


        $produtor-&gt;endereco_id = $this-&gt;cadastrarEndereco($request);
        $produtor-&gt;acesso = 1;
        //$this-&gt;cadastrarConta($request, $produtor);
        $produtor-&gt;save();

        $conta = new Conta;
        $conta-&gt;produtor_id = Auth::user()-&gt;id;
        $conta-&gt;banco_id = $request-&gt;banco;
        $conta-&gt;numero = $request-&gt;numeroConta;
        $conta-&gt;agencia = $request-&gt;agencia;
        $conta-&gt;digito = $request-&gt;digito;
        $conta-&gt;save();

        $financas = new Financa();
        $financas-&gt;produtor_id = $produtor-&gt;usuario_id;
        $financas-&gt;save();

        date_default_timezone_set('America/Sao_Paulo');
        $data = date('Y/m/d');
        $hora = date('H:i');
        $log = new Log;
        $log-&gt;usuario_id = Auth::user()-&gt;id;
        $log-&gt;operacao_id = 1;
        $log-&gt;data = $data;
        $log-&gt;hora = $hora;
        $log-&gt;save();


        return redirect()-&gt;route('produtor');



    }

    /**
     * @author Bruno Claudino
     * @param Request $request
     * @return \Illuminate\Contracts\View\Factory|\Illuminate\View\View
     */
    public function alterarProdutor(Request $request) {
//        dd($request-&gt;all());
        $dados = $request-&gt;all();
        Auth::user()-&gt;produtor-&gt;update($dados);
        $endereco = Endereco::where('id', '=', Auth::user()-&gt;produtor-&gt;endereco_id)-&gt;first();
        $cidades = Cidade::all();
        $estados = Estado::all();
        $contas = Conta::where('produtor_id', '=', Auth::user()-&gt;id);
        $bancos = Banco::all();

        date_default_timezone_set('America/Sao_Paulo');
        $data = date('Y/m/d');
        $hora = date('H:i');
        $log = new Log;
        $log-&gt;usuario_id = Auth::user()-&gt;id;
        $log-&gt;operacao_id = 2;
        $log-&gt;data = $data;
        $log-&gt;hora = $hora;
        $log-&gt;save();

        return view('dados_cadastrais_de_produtor', compact('endereco', 'contas','bancos', 'cidades', 'estados'));
    }

    /**
     * Retorna a tela dados cadastrais com todos os dados
     * @author Lucas Alves
     * @return \Illuminate\Contracts\View\Factory|\Illuminate\View\View
     */
    public function dadosCadastrais(){
        $produtor = Produtor::where('usuario_id', '=', Auth::user()-&gt;id)-&gt;first();
        $endereco = Endereco::where('id', '=', $produtor-&gt;endereco_id)-&gt;first();
        $cidades = Cidade::all();
        $estados = Estado::all();
        $contas = Conta::where('produtor_id', '=', Auth::user()-&gt;id);
        $bancos = Banco::all();
        return view('dados_cadastrais_de_produtor', compact('produtor', 'endereco', 'contas','bancos', 'cidades', 'estados'));
    }

    /**
     * Cadastra um produto
     * @author Sesaque Oliveira
     * @param Request $request
     * @return \Illuminate\Contracts\View\Factory|\Illuminate\View\View
     */
    public function cadastrarProduto(Request $request) {
        //Busca depend&ecirc;ncias
        $produtor = Auth::user()-&gt;produtor;
        $categoria = Categoria::where('nome', $request-&gt;categoria)-&gt;first();
        $embalagem = Embalagem::where('tipo', $request-&gt;embalagem)-&gt;first();


        //Criar e salva o produto
        $produto = new Produto(['seg'=&gt;false, 'ter'=&gt;false, 'qua'=&gt;false, 'qui'=&gt;false, 'sex'=&gt;false, 'sab'=&gt;false, 'dom'=&gt;false,]);
        $produto-&gt;produtor_id = $produtor-&gt;usuario_id;
        $produto-&gt;categoria_id = $categoria-&gt;id;
        $produto-&gt;embalagem_id = $embalagem-&gt;id;
        $produto-&gt;nome = $request-&gt;nome;
        $produto-&gt;descricao = $request-&gt;descricao;
        $produto-&gt;valor = $request-&gt;valor;
        $produto-&gt;minPorAssinatura = $request-&gt;minPorAssinatura;
        $produto-&gt;maxPorDia = $request-&gt;maxPorDia;
        $produto-&gt;freteMax = $request-&gt;freteMax;

        foreach ($request-&gt;entrega as $dia =&gt; $status) {
            $produto[$dia] = true;
        }

        if($request-&gt;id != null)
            $produto-&gt;id = $request-&gt;id;

        $produto-&gt;save();


        //Salva a imagem
        Foto::where('produto_id', $produto-&gt;id)-&gt;delete();

        if($request-&gt;imagem1 != null) {
            $nomeImagem = $produto-&gt;nome . '_' . $produto-&gt;id . '.' . $request-&gt;imagem1-&gt;getClientOriginalExtension();
            $request-&gt;imagem1-&gt;storeAs('produto_imagens', $nomeImagem);
            $categoria = Categoria::where('id', '=', $produto-&gt;categoria_id)-&gt;first();

            $foto = new Foto();
            $foto-&gt;produto_id = $produto-&gt;id;
            $foto-&gt;path = &quot;images/&quot; . $categoria-&gt;nome . &quot;/&quot; . $nomeImagem;
            $foto-&gt;save();

            $tmpName = $_FILES['imagem1']['tmp_name']; // Recebe o arquivo tempor&aacute;rio.
            move_uploaded_file($tmpName, &quot;images/&quot; . $categoria-&gt;nome . &quot;/&quot; . $nomeImagem);
        }
        if($request-&gt;imagem2 != null) {
            $nomeImagem = $produto-&gt;nome . '_' . $produto-&gt;id . '.' . $request-&gt;imagem2-&gt;getClientOriginalExtension();
            $request-&gt;imagem2-&gt;storeAs('produto_imagens', $nomeImagem);
            $categoria = Categoria::where('id', '=', $produto-&gt;categoria_id)-&gt;first();

            $foto = new Foto();
            $foto-&gt;produto_id = $produto-&gt;id;
            $foto-&gt;path = &quot;images/&quot; . $categoria-&gt;nome . &quot;/&quot; . $nomeImagem;
            $foto-&gt;save();

            $tmpName = $_FILES['imagem2']['tmp_name']; // Recebe o arquivo tempor&aacute;rio.
            move_uploaded_file($tmpName, &quot;images/&quot; . $categoria-&gt;nome . &quot;/&quot; . $nomeImagem);
        }

        if($request-&gt;imagem3 != null) {
            $nomeImagem = $produto-&gt;nome . '_' . $produto-&gt;id . '.' . $request-&gt;imagem3-&gt;getClientOriginalExtension();
            $request-&gt;imagem3-&gt;storeAs('produto_imagens', $nomeImagem);
            $categoria = Categoria::where('id', '=', $produto-&gt;categoria_id)-&gt;first();

            $foto = new Foto();
            $foto-&gt;produto_id = $produto-&gt;id;
            $foto-&gt;path = &quot;images/&quot; . $categoria-&gt;nome . &quot;/&quot; . $nomeImagem;
            $foto-&gt;save();

            $tmpName = $_FILES['imagem3']['tmp_name']; // Recebe o arquivo tempor&aacute;rio.
            move_uploaded_file($tmpName, &quot;images/&quot; . $categoria-&gt;nome . &quot;/&quot; . $nomeImagem);
        }



        date_default_timezone_set('America/Sao_Paulo');
        $data = date('Y/m/d');
        $hora = date('H:i');
        $log = new Log;
        $log-&gt;usuario_id = Auth::user()-&gt;id;
        $log-&gt;operacao_id = 6;
        $log-&gt;data = $data;
        $log-&gt;hora = $hora;
        $log-&gt;save();
        return redirect()-&gt;route('meusProdutos');
    }

    /**
     * Edita as informa&ccedil;&otilde;es de um produto
     * @author Sesaque Oliveira
     * @param Request $request
     * @return \Illuminate\Contracts\View\Factory|\Illuminate\View\View
     */
    public function editarProduto(Request $request) {
        $produto = Produto::find($request-&gt;id);
        if($produto == null || $produto-&gt;produtor_id != Auth::user()-&gt;produtor-&gt;usuario_id)
            return redirect()-&gt;route('index');

        return view('alterar_dados_produtos', compact('produto'));
    }


    /**
     * Alterar as informa&ccedil;&otilde;es relacionadas a um produtor
     * @author Bruno Claudino
     * @param Request $request
     * @return \Illuminate\Contracts\View\Factory|\Illuminate\View\View
     *
     */ 
    public function alterarInfoProduto(Request $request){
        $dados = $request-&gt;all();
        $produto = Produto::where('id', '=', $request-&gt;id)-&gt;first();
        $produto-&gt;update(['seg' =&gt; 0, 'ter' =&gt; 0, 'qua' =&gt; 0, 'qui' =&gt; 0, 'sex' =&gt; 0, 'sab' =&gt; 0, 'dom' =&gt; 0]);
        foreach ($request-&gt;entrega as $dia =&gt; $status) {
            $produto[$dia] = true;
        }
        $produto-&gt;update($dados);

        date_default_timezone_set('America/Sao_Paulo');
        $data = date('Y/m/d');
        $hora = date('H:i');
        $log = new Log;
        $log-&gt;usuario_id = Auth::user()-&gt;id;
        $log-&gt;operacao_id = 7;
        $log-&gt;data = $data;
        $log-&gt;hora = $hora;
        $log-&gt;save();

        return view('alterar_dados_produtos', compact('produto'));

    }

    /**
     * Cadastra um endere&ccedil;o 
     * @author Lucas Alves
     * @param Request $request
     *
     */
    public function cadastrarEndereco(Request $request) {
        $endereco = new Endereco;
        $endereco-&gt;cidade_id = $request-&gt;cidade;
        $endereco-&gt;rua = $request-&gt;rua;
        $endereco-&gt;numero = $request-&gt;numero;
        $endereco-&gt;complemento = $request-&gt;complemento;
        $endereco-&gt;bairro = $request-&gt;bairro;
        $endereco-&gt;numero_cep = $request-&gt;cep;
        $endereco-&gt;save();
    }

    /**
     * @author Lucas Alves
     * @param Request $request
     * 
     */
    public function cadastrarConta(Request $request) {
        $conta = new Conta;
        $conta-&gt;produtor_id = Auth::user()-&gt;id;
        $conta-&gt;banco_id = $request-&gt;banco;
        $conta-&gt;numero = $request-&gt;numeroConta;
        $conta-&gt;agencia = $request-&gt;agencia;
        $conta-&gt;digito = $request-&gt;digito;
        $conta-&gt;save();
    }

    /**
     * Retorna a tela reputa&ccedil;&atilde;o de produtor
     * @author Lucas Alves
     * @return \Illuminate\Contracts\View\Factory|\Illuminate\View\View
     */
    public function reputacaoProdutor(){
        $avaliacoes = Avaliacao::all();
        return view('reputacao', compact('avaliacoes'));
    }

    /**
     * Retorna a tela relacionada ao resumo do produtor 
     * @author Lucas Alves
     * @return \Illuminate\Contracts\View\Factory|\Illuminate\View\View
     */
    public function resumoConta() {
        return view('Resumo');
    }

    /**
     * Retorna os produtos relacionados a um determinado produtor
     * @author Vict&oacute;ria Gomes
     * @return \Illuminate\Contracts\View\Factory|\Illuminate\View\View
     */
    public function meusProdutos() {
        $produtos = Produto::where('produtor_id', '=', Auth::user()-&gt;id)-&gt;get();
        $embalagens = Embalagem::all();
        $categorias = Categoria::all();
        return view('produtos_cadastrados', compact('produtos', 'embalagens', 'categorias'));
    }


    /**
     * Retorna os assinaturas relacionados a um determinado produtor
     * @author Vict&oacute;ria Gomes
     * @return \Illuminate\Contracts\View\Factory|\Illuminate\View\View
     */
    public function assinaturas() {
        $assinaturas = Assinatura::where('produtor_id', '=', Auth::user()-&gt;id)-&gt;get();
        $assProdutos = Assinatura_Produto::all();
        $prodInfo = Produto::all();
        return view('assinaturas_produtor_deve_atender', compact('assinaturas', 'assProdutos', 'prodInfo'));
    }
}
</pre>
        <script type="text/javascript">
             SyntaxHighlighter.all();
             jQuery('.gutter div').each(function(key, data){
                jQuery(data).prepend('<a name="L'+jQuery(data).text()+'"/>');
             });
        </script>
    </body>
</html>